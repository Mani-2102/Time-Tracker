<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TO DO List</title>
    <script src="config.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }
      /* Dark theme */
      body.theme-dark {
        background: #0f172a;
      }
      body.theme-dark .container {
        background: #0f172a;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
        border: 1px solid #1f2937;
        color: #e5e7eb;
      }
      body.theme-dark .header {
        background: #111827;
      }
      body.theme-dark #taskInput {
        background: #111827;
        color: #e5e7eb;
        border-color: #1f2937;
      }
      body.theme-dark .task-item {
        background: #0b1221;
      }
      body.theme-dark .delete-btn {
        background: #ef4444;
      }
      body.theme-dark .stats {
        background: #111827;
        color: #e5e7eb;
      }

      .container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 500px;
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 14px;
        opacity: 0.9;
      }

      .input-section {
        padding: 20px;
        border-bottom: 1px solid #eee;
      }

      .input-group {
        display: flex;
        gap: 10px;
      }

      #taskInput {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      #taskInput:focus {
        outline: none;
        border-color: #667eea;
      }

      #addBtn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      #addBtn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      #addBtn:active {
        transform: translateY(0);
      }

      .task-list {
        padding: 20px;
        max-height: 400px;
        overflow-y: auto;
      }

      .task-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: all 0.3s;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .task-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
      }

      .task-item.completed {
        opacity: 0.6;
      }

      .task-item.completed .task-text {
        text-decoration: line-through;
        color: #999;
      }

      .checkbox {
        width: 24px;
        height: 24px;
        border: 2px solid #667eea;
        border-radius: 50%;
        margin-right: 15px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .checkbox.checked {
        background: #667eea;
      }

      .task-text {
        flex: 1;
        font-size: 16px;
        color: #333;
      }

      .delete-btn {
        background: #ff6b6b;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      .delete-btn:hover {
        background: #ee5a5a;
      }

      .stats {
        padding: 15px 20px;
        background: #f8f9fa;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: #666;
      }

      .clear-btn {
        background: transparent;
        border: 1px solid #ddd;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        color: #666;
        transition: all 0.3s;
      }

      .clear-btn:hover {
        background: #ff6b6b;
        border-color: #ff6b6b;
        color: white;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #999;
      }

      .empty-state svg {
        width: 80px;
        height: 80px;
        margin-bottom: 15px;
        opacity: 0.5;
      }
    </style>
  </head>
  <body>
    <!-- Create a link to main page "index.html" by me -->
    <!-- design Home button more attractive -->
    <div style="position: fixed; top: 20px; left: 20px">
      <a
        href="index.html"
        style="
          display: inline-block;
          background: #f0f0f0;
          color: #111;
          border: 1px solid #ddd;
          padding: 10px 15px;
          border-radius: 6px;
          font-weight: 600;
          text-decoration: none;
        "
        >üè† Home</a
      >
    </div>

    <div class="container">
      <div class="header">
        <h1>TO DO List</h1>
        <p>Stay organized, get things done!</p>
      </div>

      <div class="input-section">
        <div class="input-group">
          <input type="text" id="taskInput" placeholder="Add a new task..." />
          <button id="addBtn">Add</button>
        </div>
      </div>

      <div class="task-list" id="taskList">
        <div class="empty-state">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
            ></path>
          </svg>
          <p>No tasks yet. Add one above!</p>
        </div>
      </div>

      <div class="stats">
        <span id="taskCount">0 tasks remaining</span>
        <button class="clear-btn" id="clearBtn">Clear Completed</button>
      </div>
    </div>

    <script>
      // Sync with global theme
      (function syncTheme() {
        const theme = localStorage.getItem("tt_theme");
        if (theme === "dark") {
          document.body.classList.add("theme-dark");
        } else {
          document.body.classList.remove("theme-dark");
        }
      })();
      let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
      const taskInput = document.getElementById("taskInput");
      const addBtn = document.getElementById("addBtn");
      const taskList = document.getElementById("taskList");
      const taskCount = document.getElementById("taskCount");
      const clearBtn = document.getElementById("clearBtn");

      function saveTasks() {
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }

      function renderTasks() {
        if (tasks.length === 0) {
          taskList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                        <p>No tasks yet. Add one above!</p>
                    </div>
                `;
        } else {
          taskList.innerHTML = tasks
            .map(
              (task, index) => `
                    <div class="task-item ${task.completed ? "completed" : ""}">
                        <div class="checkbox ${task.completed ? "checked" : ""}" onclick="toggleTask(${index})"></div>
                        <span class="task-text">${task.text}</span>
                        <button class="delete-btn" onclick="deleteTask(${index})">Delete</button>
                    </div>
                `,
            )
            .join("");
        }
        updateStats();
      }

      function addTask() {
        const text = taskInput.value.trim();
        if (text) {
          const newTask = { text, completed: false };
          tasks.push(newTask);
          saveTasks();
          renderTasks();

          // Save to backend
          syncTaskToBackend(tasks.length - 1, newTask);

          taskInput.value = "";
        }
      }

      async function syncTaskToBackend(index, task) {
        const result = await todoAPI.addTodo({
          title: task.text,
          description: "",
          priority: "medium",
          completed: task.completed ? 1 : 0,
        });

        if (result.success) {
          console.log("Todo saved to backend:", result.data);
          tasks[index].id = result.data.id;
          saveTasks();
        } else {
          console.warn("Failed to save to backend:", result.error);
        }
      }

      async function syncUpdateToBackend(index, task) {
        if (!task.id) return;

        const result = await todoAPI.updateTodo(task.id, {
          title: task.text,
          description: "",
          priority: "medium",
          completed: task.completed ? 1 : 0,
        });

        if (!result.success) {
          console.warn("Failed to update on backend:", result.error);
        }
      }

      async function syncDeleteToBackend(index, task) {
        if (!task.id) return;

        const result = await todoAPI.deleteTodo(task.id);

        if (!result.success) {
          console.warn("Failed to delete from backend:", result.error);
        }
      }

      function toggleTask(index) {
        tasks[index].completed = !tasks[index].completed;
        saveTasks();
        renderTasks();
        syncUpdateToBackend(index, tasks[index]);
      }

      function deleteTask(index) {
        const task = tasks[index];
        syncDeleteToBackend(index, task);
        tasks.splice(index, 1);
        saveTasks();
        renderTasks();
      }

      function clearCompleted() {
        tasks = tasks.filter((task) => !task.completed);
        saveTasks();
        renderTasks();
      }

      function updateStats() {
        const remaining = tasks.filter((task) => !task.completed).length;
        taskCount.textContent = `${remaining} task${remaining !== 1 ? "s" : ""} remaining`;
      }

      addBtn.addEventListener("click", addTask);
      taskInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") addTask();
      });
      clearBtn.addEventListener("click", clearCompleted);

      // Load todos from backend on page load
      async function loadTodosFromBackend() {
        const result = await todoAPI.getTodos();
        if (result.success || Array.isArray(result)) {
          const backendTodos = Array.isArray(result)
            ? result
            : result.data || [];
          if (backendTodos.length > 0) {
            tasks = backendTodos.map((t) => ({
              text: t.title,
              completed: t.completed ? true : false,
              id: t.id,
            }));
            saveTasks();
            renderTasks();
          }
        }
      }

      renderTasks();
      loadTodosFromBackend();
    </script>
  </body>
</html>
